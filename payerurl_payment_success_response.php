<?php // This response will be POSTed to the notify_url of the payment request /**********Do not share the credencials*********/ // get your API key : https://dashboard.payerurl.com/profile/api-management $payerurl_public_key = ''; $payerurl_secret_key = ''; /***********************************************/ if(!isset($_SERVER['HTTP_AUTHORIZATION']) || empty($_SERVER['HTTP_AUTHORIZATION'])) { $authStr = base64_decode($_POST['authStr']); $auth = explode(':', $authStr); } else { $authStr = str_replace('Bearer ', '', $_SERVER['HTTP_AUTHORIZATION']); $authStr = base64_decode($authStr); $auth = explode(':', $authStr); } $GETDATA = [ 'order_id' => $_POST['order_id'], 'ext_transaction_id' => isset($_POST['ext_transaction_id']) ? $_POST['ext_transaction_id'] : '', 'transaction_id' => $_POST['transaction_id'], 'status_code' => isset($_POST['status_code']) ? (int)$_POST['status_code'] : '', 'note' => isset($_POST['note']) ? $_POST['note'] : '', 'confirm_rcv_amnt' => isset($_POST['confirm_rcv_amnt']) ? (float)$_POST['confirm_rcv_amnt'] : 0, 'confirm_rcv_amnt_curr' => isset($_POST['confirm_rcv_amnt_curr']) ? $_POST['confirm_rcv_amnt_curr'] : '', 'coin_rcv_amnt' => isset($_POST['coin_rcv_amnt']) ? (float)$_POST['coin_rcv_amnt'] : 0, 'coin_rcv_amnt_curr' => isset($_POST['coin_rcv_amnt_curr']) ? $_POST['coin_rcv_amnt_curr'] : '', 'txn_time' => isset($_POST['txn_time']) ? $_POST['txn_time'] : '' ]; ksort($GETDATA); $args = http_build_query($GETDATA); $signature = hash_hmac('sha256', $GETDATA, $payerurl_secret_key); $authStr = base64_encode(sprintf('%s:%s', $payerurl_public_key, $signature));
//if($signature != $auth[1]) //{ //$data = [ 'status' => 2030,'message' => "Signature not matched"]; //header('Content-Type: application/json; charset=utf-8'); //echo json_encode($data); //exit(); //} $data =""; //if($payerurl_public_key != $auth[0]) //{ // $data = [ 'status' => "Public key doesn\'t match"]; //} //else if (!isset($GETDATA['transaction_id']) || empty($GETDATA['transaction_id'])) //{ // $data = [ 'status' => 2050,'message' => "Transaction ID not found"]; //} //else if (!isset($GETDATA['order_id']) || empty($GETDATA['order_id'])) //{ // $data = [ 'status' => 2050,'message' => "Order ID not found"]; //} //else if($GETDATA['status_code'] == 20000) //{ // $data = [ 'status' => 20000,'message' => "Order Cancelled"]; //} //else{ $data = [ 'status' => 2040,'message' => "Order updated successfuly"]; ///////////// YOUR CODE HERE /////////////////////////// // //make you order update all the security check is done // ///////////// YOUR CODE HERE /////////////////////////// //} header('Content-Type: application/json; charset=utf-8'); echo json_encode($data); exit(); ?>
